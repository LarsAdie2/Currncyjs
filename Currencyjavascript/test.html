<html>
    <head>
        <title>Fixer1</title>
            <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
                    crossorigin="anonymous"></script>                                     
        <script type="application/javascript" src="js/style.js"></script>          
        <link href="css/style.css" id="stylesheet" rel="stylesheet" type="text/css">
    </head>
    <body>
        <div id="page">
            <div class="content1part0">
                <label class="label1">Select design</label>
                <div><span id="light"><button id="stylesheet1" onclick="initate('Def');ddd('a');">Default</button></span>
                    <span id="dark"><button id="stylesheet2" onclick="initate('Dark');ddd('b');">Dark</button></span></div>
                
            </div><hr/>
            <div id="header">Currency rate compared to Euro</div> 
            <div id="content1">
                <div class="content1part1">
                    <label class="label1">Number Of Rows</label>
                    <select class  ="form-control" name="state" id="maxRows">
                        <option value="5000">Show ALL</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                        <option value="70">70</option>
                        <option value="100">100</option>
                    </select>
                </div>
                <div class="content1part1">
                    <label class="label1">Select sortorder</label>
                    <select class ="form-control" name="state" id="sortOrder">
                        <option value="None">None</option>
                        <option value="Asc">Ascending</option>
                        <option value="Desc">Descending</option>
                    </select>	 		
                </div>
                <div class="content1part1">
                    <label class="label2">Date</label>
                    <input type="date" class="dateinput" id="dateinput" min="2001-01-01" max="2000-13-13"/>
                    <button id="getData" class="databutton">Get data</button>
                </div>
                <div hidden id="countrysearch" style="width:100%">
                <label class="label2">Search</label>    
                <input type="text" id="countrysearchinput" placeholder="Enter country or number to search for:"/>
                </div>
            </div><hr/>
            <div id="ratioDiv" class="content1part2" align="center"></div><hr/>
            <div class="content1part3">
            <div id="pagination" hidden align="center">
                <label>Showing</label>
                <br/>
                <button id="num1" value="0">Previous</button>
                <span id="current"></span>
                <button id="num2" value="16">Next</button>
            </div>
                
            
        </div>
        </div>
        <script type="text/javascript">
            
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth()+1; //January is 0!
        var yyyy = today.getFullYear();
        if(dd<10){dd='0'+dd} 
        if(mm<10){mm='0'+mm} 
        today = yyyy+'-'+mm+'-'+dd;
        $('#dateinput').attr("max", today);    
        // set endpoint and your access key
        // get the most recent exchange rates via the "latest" endpoint:
        $('#getData').on('click',function(){
            var endpoint ='';
            if($('#dateinput').val()!=""){
                endpoint =$('#dateinput').val();
            }else{
                endpoint ='latest';
            }
            var access_key = 'fcec1fdd6db437c19487eb77cef7e177';
            $.ajax({
                url: 'http://data.fixer.io/api/' + endpoint + '?access_key=' + access_key,   
                dataType: 'jsonp',
                success: function(json) {
                    $('#ratioDiv').html('');
                    // Table frame
                    var n='<table id="ratioTable" width="90%"><thead><tr><th width="45%">Country</th><th width="45%">Ratio</th></tr></thead><tbody>';
                    // Using a global variable for this
                    amount=0;
                    // Rows of table
                    $.each(json.rates, function( index, value ) {
                        n+='<tr><td>'+index+'</td><td>'+value.toFixed(2)+'</td></tr>';
                        amount++;
                    });
                    n+='</tbody></table>';
                    // Write it in the div
                    $('#ratioDiv').append(n);
                    // sort the table
                    sortFunction();
                    // Amount of rows
                    amountOfRows();
                    $('#pagination').show();
                    $('#countrysearch').show();
                }
            });
        });

        $('#maxRows,#sortOrder').on('change',function(){
            $('#countrysearchinput').val('');
            sortFunction();
            amountOfRows();
        });
        
        $('#countrysearchinput').on('keyup',function(){
            sortFunction();
            amountOfRows();
            if($(this).val()!=""){
                countrysearch();
            }
        });

        $('#num1,#num2').on('click',function(e){  
            sortFunction();
            if($(this).attr('id')=='num1'){
                amountOfRows('-');
            }
            if($(this).attr('id')=='num2'){
                amountOfRows('+');
            }   
        });
        
        
        

        function amountOfRows(index){ 
            if(index!=""&&typeof(index)!="undefined"){
                if(index=='+'){
                    var numberOfRow=0;
                    var minAmount=parseInt($('#num2').val());          
                    var maxAmount=parseInt($('#num2').val())+parseInt($('#maxRows option:selected').val());
                        if(maxAmount>amount){
                            maxAmount=amount;
                        $('#num2').hide();
                        }else{
                            $('#num2').show();
                        }
                    if(minAmount<1){
                        minAmount=0;
                        $('#num1').hide();
                    }else{
                        $('#num1').show();
                    }
                    $('#num1').val(minAmount);
                    $('#num2').val(maxAmount);
                    $('#current').text(Number(minAmount+1)+' to '+maxAmount);
                }
                if(index=='-'){
                    var numberOfRow=0;
                    var minAmount=parseInt($('#num1').val())-parseInt($('#maxRows option:selected').val());
                    if(minAmount<1){
                        minAmount=0;
                        $('#num1').hide();
                    }else{
                        $('#num1').show();
                    }
                    if(maxAmount>amount){
                        maxAmount=amount;
                        $('#num2').hide();
                    }else{
                        $('#num2').show();
                    }
                    var maxAmount=parseInt($('#num1').val());
                    $('#num1').val(minAmount);
                    $('#num2').val(maxAmount);
                    $('#current').text(Number(minAmount+1)+' to '+maxAmount);
                }     
            }else{
                var numberOfRow=0;
                var maxAmount=parseInt($('#maxRows option:selected').val());
                if(maxAmount>amount){
                    maxAmount=amount+1;
                    $('#num2').hide();
                }else{
                    $('#num2').show();
                }
                var minAmount=0;
                $('#num1').val(minAmount);
                $('#num2').val(maxAmount);
                $('#num1').hide();
                $('#current').text(' '+Number(minAmount+1)+' to '+maxAmount);
            }
            $('#ratioTable tbody tr').each(function(){
                if(numberOfRow<maxAmount&&numberOfRow>=minAmount){
                    $(this).show();
                }else{
                    $(this).hide();
                }
                numberOfRow++;
            });      
        }

        function sortFunction(){
            if($('#sortOrder').val()=='Asc'){
                sortRows(1,'Asc');
            }else if($('#sortOrder').val()=='Desc'){
                sortRows(1,'Desc');
            }else{
                sortRows(1,'Alpha');
            }
        }

        function sortRows(col,dir){
            $('#ratioTable tbody tr').show();
            var rows = $('#ratioTable tbody tr').get();
            var t;
            if(!dir || dir=='Desc') {
                t=-1;
            } else if(dir=='Asc') {
                t=1;
            }

            rows.sort(function(a, b) {
                if(dir=='Alpha'){
                    var A = $(a).children('td').eq(0).text().toUpperCase();
                    var B = $(b).children('td').eq(0).text().toUpperCase();
                }else{
                    var A = Number($(a).children('td').eq(1).text().trim());
                    var B = Number($(b).children('td').eq(1).text().trim());
                }
                if(A < B) {
                    return -t;
                }
                if(A > B) {
                    return t;
                }
                return 0;
                });
            $.each(rows, function(index, row) {
                $('#ratioTable').children('tbody').append(row);
            });
        }
        
        function countrysearch() {
            var value=$('#countrysearchinput').val().toUpperCase();
            var n="";
            $('#ratioTable tr').each(function(){
               if($(this).children(0).text().indexOf(value)>-1){
                   $(this).show();
                   n++;
               }else{
                   $(this).hide();
               } 
            });
            $('#current').text(' '+1+' to '+n);
        }
        
        
        </script>
    </body>
</html>

